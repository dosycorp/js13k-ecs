var t=[],n=[],r={},e="_sign",o="_mask";Symbol&&(e=Symbol(e),o=Symbol(o));var i=function(t,n){var r=n[t];if(!r)throw new Error("The component is not registered");return r},s=i.bind(null,e),c=i.bind(null,o),a=function(n){n.id&&t.forEach(function(t){return t.match(n)})},h=1,u=function(t){this.id=t||(h++).toString(36),this.components={},this.mask=0};u.prototype.add=function(){for(var t=this,n=[],r=arguments.length;r--;)n[r]=arguments[r];n.forEach(function(n){t.components[s(n.constructor)]=n,t.mask|=c(n.constructor)}),a(this)},u.prototype.remove=function(){for(var t=this,n=[],r=arguments.length;r--;)n[r]=arguments[r];n.forEach(function(n){var r=s(n),e=t.components[r];e&&(e.destructor&&e.destructor(),delete t.components[r],t.mask&=~c(n))}),a(this)},u.prototype.has=function(t){return s(t)in this.components},u.prototype.get=function(t){return this.components[s(t)]},u.prototype.eject=function(){var n;n=this,Object.values(n.components).forEach(function(t){return t.destructor&&t.destructor()}),t.forEach(function(t){return t.remove(n)}),delete r[n.id],n.id=0};var f=function(t){var n=this;if(!t)throw new Error("Empty selector");this.mask=t,this.map={},this.list=null,this.length=0,Object.values(r).forEach(function(t){return n.match(t)})};f.prototype.iterate=function(t){for(var n=this.list;n;)t(n.entity),n=n.next},f.prototype.match=function(t){(this.mask&t.mask)===this.mask?this.add(t):this.remove(t)},f.prototype.add=function(t){if(!this.map[t.id]){var n=new function(t,n){this.entity=t,this.prev=null,this.next=n}(t,this.list);this.list&&(this.list.prev=n),this.list=n,this.map[t.id]=n,this.length++}},f.prototype.remove=function(t){var n=this.map[t.id];n&&(n.prev?n.prev.next=n.next:this.list=n.next,n.next&&(n.next.prev=n.prev),delete this.map[t.id],this.length--)};var p=0,m=performance||Date,l=m.now.bind(m);module.exports={register:function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];t.forEach(function(t){if(p>31)throw new Error("Components limit reached");t[e]||(t[e]=p.toString(36),t[o]=1<<p,p++)})},process:function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];t.forEach(function(t){return n.push(t)})},create:function(t){var n=new u(t);if(r[n.id])throw new Error("The ID already exist");return r[n.id]=n,n},get:function(t){return r[t]},select:function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];var e=0;n.forEach(function(t){e|=c(t)});var o=t.find(function(t){return t.mask===e});if(o)return o;var i=new f(e);return t.push(i),i},update:function(t){var r={};return n.forEach(function(n){var e=l();n.update(t),r[n.constructor.name]=l()-e}),r}};
